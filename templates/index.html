<!DOCTYPE html>
<html>
  <head>
    <title>Cabinet Cut Planner</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #drop-area {
        border: 2px dashed #0d6efd;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
      }
      #preview img {
        max-width: 100px;
        margin: 5px;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <h1 class="mb-4 text-center">Cabinet Cut Planner</h1>

      <div class="card p-4 shadow">
        <form method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Client Name:</label>
            <input
              type="text"
              name="client_name"
              class="form-control"
              required
            />
          </div>

          <div id="parts-list">
            <h5>Parts List</h5>
            <div class="row mb-2">
              <div class="col">
                <label class="form-label">Width (in):</label>
                <input
                  type="number"
                  step="0.1"
                  name="widths"
                  class="form-control"
                />
              </div>
              <div class="col">
                <label class="form-label">Height (in):</label>
                <input
                  type="number"
                  step="0.1"
                  name="heights"
                  class="form-control"
                />
              </div>
              <div class="col">
                <label class="form-label">Quantity:</label>
                <input
                  type="number"
                  name="quantities"
                  value="1"
                  class="form-control"
                />
              </div>
            </div>
          </div>

          <button
            type="button"
            class="btn btn-secondary mb-3"
            onclick="addRow()"
          >
            Add Another Part
          </button>

          <div class="mb-3">
            <label class="form-label">Panel Width (default 96):</label>
            <input
              type="number"
              step="0.1"
              name="panel_width"
              value="96"
              class="form-control"
            />
          </div>

          <div class="mb-3">
            <label class="form-label">Panel Height (default 48):</label>
            <input
              type="number"
              step="0.1"
              name="panel_height"
              value="48"
              class="form-control"
            />
          </div>

          <!-- âœ… NEW: Drag & Drop Multi-File Upload -->
          <div class="mb-3">
            <label class="form-label">Upload Files (Images, PDFs, etc):</label>
            <div id="drop-area">
              <p>Drag & drop files here, or click to select</p>
              <input type="file" name="files" id="fileElem" multiple hidden />
              <button
                type="button"
                class="btn btn-outline-primary"
                onclick="fileElem.click()"
              >
                Select Files
              </button>
              <div id="preview" class="mt-3"></div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100">
            Generate Cut Plan
          </button>
          <a href="{{ url_for('jobs') }}" class="btn btn-outline-primary mt-3"
            >View Saved Jobs</a
          >
        </form>
      </div>
    </div>

    <script>
      function addRow() {
        const partsList = document.getElementById("parts-list");
        const newRow = document.createElement("div");
        newRow.className = "row mb-2";
        newRow.innerHTML = `
          <div class="col">
            <input type="number" step="0.1" name="widths" class="form-control" placeholder="Width">
          </div>
          <div class="col">
            <input type="number" step="0.1" name="heights" class="form-control" placeholder="Height">
          </div>
          <div class="col">
            <input type="number" name="quantities" value="1" class="form-control" placeholder="Quantity">
          </div>
        `;
        partsList.appendChild(newRow);
      }

      // Drag & Drop + Preview
      let dropArea = document.getElementById("drop-area");
      let fileInput = document.getElementById("fileElem");
      let preview = document.getElementById("preview");

      dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.classList.add("bg-light");
      });

      dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        showFiles(fileInput.files);
      });

      fileInput.addEventListener("change", () => {
        showFiles(fileInput.files);
      });

      function showFiles(files) {
        preview.innerHTML = "";
        [...files].forEach((file) => {
          if (file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const img = document.createElement("img");
              img.src = e.target.result;
              preview.appendChild(img);
            };
            reader.readAsDataURL(file);
          } else {
            const p = document.createElement("p");
            p.textContent = file.name;
            preview.appendChild(p);
          }
        });
      }
    </script>
  </body>
</html>
