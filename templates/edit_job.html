<!DOCTYPE html>
<html>
  <head>
    <title>Edit Job</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #drop-area {
        border: 2px dashed #0d6efd;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
      }
      #preview img {
        max-width: 100px;
        margin: 5px;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <h1 class="mb-4 text-center">Edit Job</h1>
      <div class="card p-4 shadow">
        <form method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Client Name:</label>
            <input
              type="text"
              name="client_name"
              value="{{ job.client_name }}"
              class="form-control"
              required
            />
          </div>

          <!-- Drag & Drop Upload for Adding More Files -->
          <div class="mb-3">
            <label class="form-label">Add More Files:</label>
            <div id="drop-area">
              <p>Drag & drop or click to select files</p>
              <input type="file" name="files" id="fileElem" multiple hidden />
              <button
                type="button"
                class="btn btn-outline-primary"
                onclick="fileElem.click()"
              >
                Select Files
              </button>
              <div id="preview" class="mt-3"></div>
            </div>
          </div>

          <button type="submit" class="btn btn-success">Save Changes</button>
          <a href="{{ url_for('jobs') }}" class="btn btn-secondary">Cancel</a>
        </form>
      </div>
    </div>

    <script>
      let dropArea = document.getElementById("drop-area");
      let fileInput = document.getElementById("fileElem");
      let preview = document.getElementById("preview");

      dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.classList.add("bg-light");
      });

      dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        showFiles(fileInput.files);
      });

      fileInput.addEventListener("change", () => {
        showFiles(fileInput.files);
      });

      function showFiles(files) {
        preview.innerHTML = "";
        [...files].forEach((file) => {
          if (file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = (e) => {
              const img = document.createElement("img");
              img.src = e.target.result;
              preview.appendChild(img);
            };
            reader.readAsDataURL(file);
          } else {
            const p = document.createElement("p");
            p.textContent = file.name;
            preview.appendChild(p);
          }
        });
      }
    </script>
  </body>
</html>
